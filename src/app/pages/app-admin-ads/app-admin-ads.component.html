<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/main-tab/list-reports"></ion-back-button>
    </ion-buttons>
    <ion-title>Administrar Publicidad</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openCreateModal()" fill="clear">
        <ion-icon name="add" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Administrar Publicidad</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Botón de crear nueva publicidad -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openCreateModal()" color="primary">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Lista de publicidades -->
  <div class="ads-container">
    <ion-card *ngFor="let ad of advertisements$ | async" class="ad-card">
      <div class="ad-media-container">
        <!-- Mostrar imagen o video según mediaType -->
        <img *ngIf="ad.mediaType === 'image'" [src]="ad.mediaUrl" [alt]="ad.title || 'Publicidad'" class="ad-media">

        <video *ngIf="ad.mediaType === 'video'" [src]="ad.mediaUrl" class="ad-media" controls muted>
        </video>

        <ion-chip [color]="getStatusColor(ad.active)" class="status-chip">
          {{ getStatusText(ad.active) }}
        </ion-chip>

        <!-- Chip para tipo de publicidad -->
        <ion-chip [color]="ad.type === 'popup' ? 'secondary' : 'tertiary'" class="type-chip">
          {{ ad.type === 'popup' ? 'Pop-up' : 'Nativo' }}
        </ion-chip>
      </div>

      <ion-card-header>
        <ion-card-title>{{ ad.title || 'Sin título' }}</ion-card-title>
        <ion-card-subtitle>
          Tipo: {{ ad.mediaType === 'image' ? 'Imagen' : 'Video' }} |
          Orden: {{ ad.order || 'Sin orden' }}
        </ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <p *ngIf="ad.description">{{ ad.description }}</p>
        <p *ngIf="!ad.description" class="no-description">Sin descripción</p>

        <!-- Información de timing -->
        <div class="timing-info">
          <ion-text color="medium">
            <small>
              <ion-icon name="time-outline"></ion-icon>
              Espera: {{ ad.waitTime }}s
              <span *ngIf="ad.skipAfter"> | Auto-cierre: {{ ad.skipAfter }}s</span>
            </small>
          </ion-text>
        </div>

        <!-- Link si existe -->
        <div *ngIf="ad.link" class="link-info">
          <ion-text color="primary">
            <small>
              <ion-icon name="link-outline"></ion-icon>
              {{ ad.link }}
            </small>
          </ion-text>
        </div>

        <ion-text color="medium">
          <small>
            Creado: {{ ad.createdAt | date:'dd/MM/yyyy HH:mm' }} |
            Actualizado: {{ ad.updatedAt | date:'dd/MM/yyyy HH:mm' }}
          </small>
        </ion-text>
      </ion-card-content>

      <ion-row class="ad-actions">
        <ion-col>
          <ion-button expand="block" fill="clear" (click)="editAdvertisement(ad)">
            <ion-icon name="create" slot="start"></ion-icon>
            Editar
          </ion-button>
        </ion-col>
        <ion-col>
          <ion-button expand="block" fill="clear" [color]="ad.active ? 'warning' : 'success'"
            (click)="toggleAdStatus(ad)">
            <ion-icon [name]="ad.active ? 'pause' : 'play'" slot="start"></ion-icon>
            {{ ad.active ? 'Pausar' : 'Activar' }}
          </ion-button>
        </ion-col>
        <ion-col>
          <ion-button expand="block" fill="clear" color="danger" (click)="deleteAdvertisement(ad)">
            <ion-icon name="trash" slot="start"></ion-icon>
            Eliminar
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-card>
  </div>

  <!-- Estado vacío -->
  <div *ngIf="(advertisements$ | async)?.length === 0" class="empty-state">
    <ion-icon name="megaphone-outline" size="large" color="medium"></ion-icon>
    <h2>No hay publicidades</h2>
    <p>Crea tu primera publicidad tocando el botón +</p>
    <ion-button (click)="openCreateModal()" expand="block" color="primary">
      Crear primera publicidad
    </ion-button>
  </div>
</ion-content>